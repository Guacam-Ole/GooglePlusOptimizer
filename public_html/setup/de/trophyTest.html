<!DOCTYPE html>
<!--
To change this license header, choose License Headers in Project Properties.
To change this template file, choose Tools | Templates
and open the template in the editor.
-->
<html>
    <head>
        <title>TODO supply a title</title>
        <meta charset="UTF-8">
        <meta name="viewport" content="width=device-width">

        <style>
            .trophyRow {
                min-height: 100px;
            }
            .trophyGold {
                background-image: url(../images/trophygold.png);    
                background-repeat: no-repeat;

                padding-left: 90px;
            }
            .trophySilber {
                background-image: url(../images/trophysilver.png);        
                background-repeat: no-repeat;
                padding-left: 90px;
            }
            .trophyBronze {
                background-image: url(../images/trophybronze.png);        
                background-repeat: no-repeat;
                padding-left: 90px;
            }

            .badge {
                background-color:#333333; //ffffff; // #4387fd;
                border: 1px solid #4387fd;
                margin: 0 3px 3px 0;
                display: inline-block;
                text-decoration: none;
                white-space: nowrap;
                //line-height: 32px;
                border-radius: 4px;
                font: normal 13px Roboto,arial,sans-serif;  
                //font-weight: bold;
                background-repeat: no-repeat;
                background-position-y: center;
                background-position-x: 4px; 
                padding-left:15px;
                padding-right:5px;
                padding-top: 4px;
                //padding-top:5px;
                height: 22px;
                //vertical-align: middle;


            }
            .gold {
                background-image: url(../images/gold.png);     
                color: #FFCC00;
            }
            .silber {
                background-image: url(../images/silber.png);        
                color: #C5C5C5;
            }
            .bronze {
                background-image: url(../images/bronze.png);        
                color: #CC9966;
            }
        </style>
        <script type="text/javascript" src="../js/jquery-1.10.2.min.js" language="javascript"></script>
        <script type="text/javascript" src="../../date.js" language="javascript"></script>

        <script type="text/javascript" src="../js/oauth/chrome_ex_oauthsimple.js"></script>
        <script type="text/javascript" src="../js/oauth/chrome_ex_oauth.js"></script>
        <script type="text/javascript" src="../js/oauth/onload.js"></script>


        <script>




            var apiKey = "AIzaSyBPrLCzHYttlTo2azF-DfIYyV8BhZ4Z2EY";
            var counter = 0;
            var oldestDate;
            var lastDate = null;
            var continous = 0;
            var maxContinous = 0;
            var messageCount = 0;
            var postCount = 0;
            var checkinCount = 0;
            var shareCount = 0;
            var maxShares = 0;
            var maxPlus = 0;
            var maxComments = 0;
            var trophyList = [];
            var continousStart = null;
            var one_day = 1000 * 60 * 60 * 24;

            /* Live: 
             * goldWham
             * goldFriends,silberFriends,bronzeFriends
             * goldTrekkie
             * goldBild
             * goldBrain
             * silberOptimizer
             
             
             */

            var oauth = ChromeExOAuth.initBackgroundPage({
                'request_url': 'https://www.google.com/accounts/OAuthGetRequestToken',
                'authorize_url': 'https://www.google.com/accounts/OAuthAuthorizeToken',
                'access_url': 'https://www.google.com/accounts/OAuthGetAccessToken',
                'consumer_key': '249838705220.apps.googleusercontent.com',
                'consumer_secret': 'NTq4w5gOYB3iuRR0EbfhfGUU',
                'scope': 'https://docs.google.com/feeds/',
                'app_name': 'Google+ Optimizer'
            });

            function GetAuth()
            {
                oauth.authorize(function() {
                    alert('geht los jetzt!');
                });
            }

            /* URLS:
             * goldSupport
             * silberKickstarter
             * bronzeSchwierig
             * bronzeVanity
             * bronzeXing
             * bronzeProgger
             * bronzeStats
             * bronzeFun
             * bronzeNerd
             * bronzeLeiche
             * bronzeFun
             * bronzeHH
             * 
             */
            function GetStatistics(userId, pageToken)
            {
                if (pageToken === undefined) {
                    pageToken = "";
                }

                var url = "https://www.googleapis.com/plus/v1/people/" + userId + "/activities/public?fields=items(annotation%2Cobject(content%2Cplusoners%2FtotalItems%2Creplies%2FtotalItems%2Cresharers%2FtotalItems)%2Cpublished%2Cverb)%2CnextPageToken&maxResults=100&key=" + apiKey + "&pageToken=" + pageToken;
                $.getJSON(url, function(data)
                {

                    if (data.items.length > 0)
                    {
                        for (var i in data.items)
                        {
                            var item = data.items[i];
                            // Counts:
                            messageCount++;
                            if (item.verb === "share")
                            {
                                shareCount++;
                            } else if (item.verb === "post") {
                                postCount++;
                            } else if (item.verb === "checkin") {
                                checkinCount++;
                            } else
                            {
                                alert("unknown verb");
                            }

                            // Datumsfunktionen:
                            var itemDate = Date.parse(item.published.split('.')[0]);

                            if (lastDate !== null)
                            {
                                diff = Math.ceil((lastDate - itemDate) / (one_day));
                                if (diff > 1)
                                {
                                    if (continousStart !== null)
                                    {
                                        continous = Math.ceil((continousStart - itemDate) / (one_day));
                                        if (continous > maxContinous) {
                                            maxContinous = continous;
                                        }
                                    }
                                    continousStart = itemDate;
                                }
                            } else
                            {
                                continousStart = itemDate;
                            }
                            lastDate = itemDate;
                            // Maximalwerte:
                            var replies = JSON.parse(item.object.replies.totalItems);
                            var shares = JSON.parse(item.object.resharers.totalItems);
                            var plusses = JSON.parse(item.object.plusoners.totalItems);
                            var twoWeeks = Date.today();
                            twoWeeks.add(-2).weeks();
                            if (itemDate < twoWeeks) {
                                if (replies === 0 && shares === 0 && plusses === 0) {
                                    A2T("bronzeBoring");
                                }
                            }
                            if (replies > maxComments)
                            {
                                maxComments = replies;
                            }
                            if (shares > maxShares)
                            {
                                maxShares = shares;
                            }
                            if (plusses > maxPlus) {
                                maxPlus = plusses;
                            }

                            // Content:
                            var currentPost = "";
                            if (item.verb === "share") {
                                currentPost += item.annotation + " ";
                            }
                            currentPost += item.object.content;
                            if (currentPost.indexOf("#towelday") >= 0 && itemDate.month === 5 && itemDate.day === 25)
                            {
                                A2T("goldTowel");
                            }
                            if ((currentPost.indexOf("3,14") >= 0 || currentPost.indexOf("3.14") >= 0) && itemDate.month === 3 && itemDate.day === 14)
                            {
                                A2T("silberPi");
                            }
                            if (itemDate.month === 9 && itemDate.month === 19) {
                                if (currentPost.indexOf("Avast") >= 0 || currentPost.indexOf("Ayy") >= 0 || currentPost.indexOf("Arrr") >= 0 || currentPost.indexOf("Ahoi") >= 0)
                                {
                                    A2T("silberPirate");
                                }
                            }
                            if (currentPost.indexOf("#fairphone") >= 0) {
                                A2T("silberFairphone");
                            }
                            if (currentPost.indexOf("#caturday") >= 0) {
                                A2T("bronzeCat");
                            }
                            if (currentPost.indexOf("#tgif") >= 0) {
                                A2T("bronzeTgif");
                            }
                            if (itemDate.is().thursday() && (currentPost.indexOf("Döner") >= 0 || currentPost.indexOf("döner") >= 0))
                            {
                                A2T("bronzeDoener");
                            }
                            if (itemDate.is().friday() && itemDate.getHours() > 22) {
                                A2T("bronzeNerd");
                            }
                            if (currentPost.indexOf("<i>") >= 0) {
                                A2T("bronzeItalic");
                            }
                            if (currentPost.indexOf("<b>") >= 0) {
                                A2T("bronzeBold");
                            }
                            if (currentPost.indexOf("<s>") >= 0) {
                                A2T("bronzeStrike");
                            }
                            if (currentPost.indexOf("Moin") >= 0 || currentPost.indexOf("moin") >= 0) {
                                A2T("bronzeNorddeutsch");
                            }
                            if (currentPost.indexOf("Justin Bieber") >= 0 || currentPost.indexOf("#justinbieber") >= 0) {
                                A2T("bronzeJustin");
                            }
                            if (itemDate !== null && itemDate !== undefined) {
                                oldestDate = itemDate;
                            }

                        }
                    }
                    if (itemDate !== null && itemDate !== undefined) {
                        $('#currentDate').html("Aktuelles Datum: " + itemDate.toString("d.M.yyyy h:m"));
                    }
                    if (data.nextPageToken !== null && data.nextPageToken !== undefined && data.nextPageToken !== "")
                    {
                        GetStatistics(userId, data.nextPageToken);
                    } else
                    {
                        CollectStatisticsFinal();
                        alert('bingo!');
                        return oldestDate;
                    }
                    counter++;

                    console.log(counter + " " + pageToken);
                });
            }
            ;
            function A2T(value)
            {
                if (trophyList.indexOf(value) >= 0)
                {
                    return;
                }
                trophyList.push(value);
            }

            function CollectStatisticsFinal()
            {
                if (maxShares >= 10)
                {
                    A2T("bronzeShare");
                    if (maxShares >= 50)
                    {
                        A2T("silberShare");
                        if (maxShares >= 250)
                        {
                            A2T("goldShare");
                        }
                    }
                }

                if (maxPlus >= 20)
                {
                    A2T("bronzePlus");
                    if (maxPlus >= 200)
                    {
                        A2T("silberPlus");
                        if (maxPlus >= 500) {
                            A2T("goldPlus");
                        }
                    }
                }
                if (maxComments >= 10)
                {
                    A2T("bronzeComment");
                    if (maxComments >= 50)
                    {
                        A2T("silberComment");
                        if (maxComments >= 500)
                        {
                            A2T("goldComment");
                        }
                    }
                }

                if (oldestDate <= Date.today().add(-1).months())
                {
                    A2T("bronzeOld");
                    if (oldestDate <= Date.today().add(-1).years())
                    {
                        A2T("silberOld");
                        if (oldestDate <= Date.today().add(-2).years())
                        {
                            A2T("goldOld");
                        }
                    }
                }
                if (oldestDate.getFullYear() <= 2011)
                {
                    A2T("goldAdopt");
                }
                if (maxContinous >= 30)
                {
                    A2T("bronzeSteady");
                    if (maxContinous >= 90) {
                        A2T("silberSteady");
                    }
                }

                $('#currentDate').val("fertig");
            }

            function StartCalculation(id)
            {
                if (id === "109932908573405797116") {
                    A2T("goldDev");
                }
                GetStatistics(id);

            }
            
            GetAuth();
            //StartCalculation("109932908573405797116");


        </script>
    </head>
    <body>
        <div style="width: 440px; border-style: solid; border-width: 5px;">

            <div data-iid="sii2:103" tabindex="-1" class="nja">
                <div class="Ee fP Ue q5 Ls" role="article">

                    <span id="currentDate">Aktuelles Datum:</span>
                    <div class="a5 Gi">
                        <h3 class="EY Ni zj"><span>Trophäen</span></h3>                        
                    </div>
                    <div class="trophyRow trophyGold">
                        <span title="Hat die Weltherrschaft erlangt" class="badge gold">Weltherrschaft</span>
                        <span title="Hat dieses PlugIn programmiert" class="badge gold">Programmiergott</span>
                        <span title="Hat einen Beitrag mit mindestens 1000 +1 geschrieben" class="badge gold">Phantastischer Beitrag</span>
                        <span title="Hat einen Beitrag geschrieben, der mindestens 1000 Mal geteilt wurde" class="badge gold">Öffentlichkeitswirksam</span>
                        <span title="Hat über Weihnachten den WHAM-Filter aktiviert" class="badge gold">Stille Nacht</span>                        
                    </div>
                    <div class="trophyRow trophySilber">
                        <span title="Hat einen Beitrag mit mindestens 100 +1 geschrieben" class="badge silber">Toller Beitrag</span>
                        <span title="Hat einen Beitrag geschrieben, der mindestens 100 Mal geteilt wurde" class="badge silber">Extrovertiert</span>
                    </div>
                    <div class="trophyRow trophyBronze">
                        <span title="Hat einen Beitrag mit mindestens 10 +1 geschrieben" class="badge bronze">Guter Beitrag</span>
                        <span title="Hat einen Beitrag geschrieben, der mindestens 10 Mal geteilt wurde" class="badge bronze">Interessanter Beitrag</span>
                    </div>
                </div></div>

            t</div>


    </body>
</html>
